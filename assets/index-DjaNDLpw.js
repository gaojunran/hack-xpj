import{_ as z}from"./_plugin-vue_export-helper-DbAqXja1.js";import{g as M,p as W}from"./dataService-BDxKwLV3.js";/* empty css              *//* empty css              */import{s as R,a as X}from"./index-B9weXtLP.js";import{r as v,w as V,l as E,m as Y,c as ee,a as I,P as te,o as c,g as e,f as r,h as U,b as _,t as u,n as se,d as B,p as G,F as x,q as T,R as oe,C as ae,s as le,B as A,v as ne,x as ce}from"./index-BPh6w-Hv.js";const re={class:"popup-content"},ue={class:"popup-header"},ie={class:"header-top"},pe={class:"course-info"},de={class:"popup-course-name"},ve={key:0,class:"header-progress"},me={class:"popup-body"},_e={class:"section-title"},he={class:"eval-items"},fe={class:"item-name"},ge={class:"eval-section"},Ce={key:0,class:"popup-footer"},je={__name:"EvaluationPopup",props:{show:{type:Boolean,default:!1},course:{type:Object,default:()=>({})},pjCs:{type:Number,default:0}},emits:["update:show","submit"],setup(C,{emit:F}){const d=v({action:"stuGetJxbZb",jxb:"",teaId:"",pjCs:""}),D=async()=>{d.value.jxb=a.course.jxb,d.value.teaId=a.course.teaId,d.value.pjCs=a.pjCs>0?a.pjCs:"";const o=await M(d.value);i.value=o.data.data},a=C,$=F,h=v(a.show);V(()=>a.show,async o=>{h.value=o,o&&(await D(),P())}),V(h,o=>{$("update:show",o)});const i=v({}),f=E(()=>!i.value||typeof i.value!="object"?[]:Object.entries(i.value).filter(([o,n])=>o!=="memo"&&Array.isArray(n)).map(([o,n])=>({firstLevel:o||"未知维度",items:n||[]})).filter(o=>o.items.length>0)),p=v({scores:[],memo:null}),w=v(0),L=E(()=>a.pjCs===0?`第${(a.course.pjNum||0)+1}次评价`:`第${a.pjCs}次评价`),g=v(30),t=v(null),s=()=>{g.value=30,t.value&&clearInterval(t.value),t.value=setInterval(()=>{g.value--,g.value<=0&&clearInterval(t.value)},1e3)},j=()=>{t.value&&clearInterval(t.value)},P=()=>{if(!a.course||Object.keys(i.value).length===0)return;const o=[];f.value.forEach(({firstLevel:n,items:N})=>{N.forEach(m=>{m?.orderNum!==void 0&&(o[m.orderNum-1]={orderNum:m.orderNum,score:parseInt(m.score)})})}),p.value.scores=o,p.value.memo=a.pjCs===0?null:i.value.memo||null,w.value=a.pjCs===0?0:100},l=()=>{if(a.pjCs!==0)return;const n=f.value.reduce((m,{items:b})=>m+b.length,0);let N=0;f.value.forEach(({items:m})=>{m.forEach(b=>{b?.orderNum!==void 0&&p.value.scores[b.orderNum-1].score!==null&&p.value.scores[b.orderNum-1].score>0&&N++})}),w.value=n>0?Math.round(N/n*100):100};V(()=>i.value,o=>{h.value&&o&&Object.keys(o).length>0&&(P(),a.pjCs===0&&s())},{deep:!0}),V(()=>p.value,()=>{a.pjCs===0&&l()},{deep:!0});const y=()=>{h.value=!1},O=()=>{$("submit",{action:"stuPj",jxb:a.course.jxb,teaId:a.course.teaId,scoreDetail:p.value.scores,memoDetail:p.value.memo})},q=()=>{if(!(g.value>0)){if(w.value<100){R({message:"请完成所有评价项后再提交",type:"warning",duration:2e3});return}X({title:"确认提交",message:"提交后评价将无法更改，是否确定提交？"}).then(()=>O()).catch(()=>{})}};return Y(j),(o,n)=>{const N=se,m=G,b=oe,H=le,J=ae,Z=A,K=te;return c(),ee(K,{show:h.value,"onUpdate:show":n[1]||(n[1]=k=>h.value=k),position:"bottom",style:{height:"90%",paddingTop:"16px",paddingBottom:"16px",overflow:"hidden"},closeable:"",onClickOverlay:y,onClickCloseIcon:y},{default:I(()=>[e("div",re,[e("div",ue,[e("div",ie,[e("div",pe,[e("h3",de,u(C.course.kcmc||"未知课程")+"-"+u(C.course.teaName||"未知教师"),1)]),_(N,{plain:"",color:"#006633"},{default:I(()=>[B(u(L.value),1)]),_:1})]),C.pjCs===0?(c(),r("div",ve,[n[2]||(n[2]=e("span",{class:"completion-text"},"本次评价完成度：",-1)),_(m,{percentage:w.value,class:"popup-progress","stroke-width":"4",color:"#006633","show-pivot":!0,"pivot-text":`${w.value}%`,"pivot-color":"#006633"},null,8,["percentage","pivot-text"])])):U("",!0)]),e("div",me,[(c(!0),r(x,null,T(f.value,k=>(c(),r("div",{class:"eval-section",key:k.firstLevel},[e("h4",_e,u(k.firstLevel),1),e("div",he,[(c(!0),r(x,null,T(k.items,S=>(c(),r("div",{class:"eval-item",key:S.zbId},[e("span",fe,u(S.info),1),_(b,{modelValue:p.value.scores[S.orderNum-1].score,"onUpdate:modelValue":Q=>p.value.scores[S.orderNum-1].score=Q,count:10,readonly:C.pjCs!==0,onChange:l,class:"rate-right"},null,8,["modelValue","onUpdate:modelValue","readonly"])]))),128))])]))),128)),e("div",ge,[n[3]||(n[3]=e("h4",{class:"section-title"},"你认为该教师在教学上的突出优点或需改进之处",-1)),_(J,{inset:""},{default:I(()=>[_(H,{modelValue:p.value.memo,"onUpdate:modelValue":n[0]||(n[0]=k=>p.value.memo=k),rows:"3",autosize:"",type:"textarea",placeholder:"请输入您的意见或建议",readonly:C.pjCs!==0,onInput:l},null,8,["modelValue","readonly"])]),_:1})])]),C.pjCs===0?(c(),r("div",Ce,[_(Z,{class:"submit-btn",round:"",onClick:q,disabled:g.value>0},{default:I(()=>[g.value>0?(c(),r(x,{key:0},[B(u(g.value)+"秒后可提交",1)],64)):(c(),r(x,{key:1},[B("提交保存")],64))]),_:1},8,["disabled"])])):U("",!0)])]),_:1},8,["show"])}}},we=z(je,[["__scopeId","data-v-fb959e9a"]]),ye={class:"evaluation-container"},be={class:"evaluation-page"},ke={class:"completion-section"},Ne={class:"completion-item"},xe={class:"completion-value"},$e={class:"completion-item"},Ie={class:"completion-value"},Ee={class:"course-list"},De={class:"course-header"},Pe={class:"course-info"},Se={class:"course-name"},Ve={class:"course-teacher"},Be={class:"rank-tag"},Te={class:"course-stats"},Fe={class:"evaluation-records"},Le={class:"record-circles"},Ue=["onClick"],Oe={key:0,class:"incomplete-hint"},ze={__name:"index",setup(C){const F=v({action:"stuGetRw"});ne(async()=>{await D()});const d=v([]),D=async()=>{const t=await M(F.value);d.value=t.data.data},a=E(()=>[...d.value].sort((t,s)=>t.pm-s.pm)),$=E(()=>{const t=d.value.length;if(t===0)return 0;const s=d.value.filter(j=>j.pjNum>=1).length;return Math.round(s/t*100)}),h=E(()=>{const t=d.value.length;if(t===0)return 0;const s=d.value.filter(j=>j.pjNum>=2).length;return Math.round(s/t*100)}),i=v(!1),f=v({course:null,pjCs:0}),p=t=>{f.value={course:{...t},pjCs:0},i.value=!0},w=(t,s)=>{f.value={course:{...t},pjCs:s+1},i.value=!0},L=()=>{i.value=!1},g=async t=>{try{await W(t),await D(),L()}catch(s){R(s.info)}};return(t,s)=>{const j=G,P=A;return c(),r("div",ye,[e("div",be,[e("div",ke,[e("div",Ne,[s[1]||(s[1]=e("span",{class:"completion-label"},"半期课程评价完成度",-1)),_(j,{percentage:$.value,class:"completion-progress","stroke-width":"6",color:"#006633","show-pivot":!1},null,8,["percentage"]),e("span",xe,u($.value)+"%",1)]),e("div",$e,[s[2]||(s[2]=e("span",{class:"completion-label"},"总课程评价完成度",-1)),_(j,{percentage:h.value,class:"completion-progress","stroke-width":"6",color:"#006633","show-pivot":!1},null,8,["percentage"]),e("span",Ie,u(h.value)+"%",1)])]),s[4]||(s[4]=e("div",{class:"note"}," 请各位同学放心打分，系统严格保护学生个人评价隐私，任课教师没有任何途径可以知晓评价人信息。 ",-1)),e("div",Ee,[(c(!0),r(x,null,T(a.value,l=>(c(),r("div",{key:l.jxb,class:"course-card",style:ce({order:l.pm})},[e("div",De,[e("div",Pe,[e("span",Se,"课程名称："+u(l.kcmc),1),e("span",Ve,"教师："+u(l.teaName),1)]),e("div",Be,u(l.pm),1)]),e("div",Te,[e("span",null,"评价总次数："+u(l.pjNum)+"次",1),e("span",null,"平均得分："+u(l.score||"暂无"),1)]),e("div",Fe,[e("div",Le,[(c(!0),r(x,null,T(l.pjNum,y=>(c(),r("div",{key:y,class:"record-circle",onClick:O=>w(l,y-1)},u(y),9,Ue))),128))]),l.pjNum<2?(c(),r("div",Oe,"评价次数未完成")):U("",!0)]),_(P,{class:"new-eval-btn",type:"primary",size:"small",onClick:y=>p(l)},{default:I(()=>[...s[3]||(s[3]=[B(" 新评价 ",-1)])]),_:1},8,["onClick"])],4))),128))]),_(we,{show:i.value,course:f.value.course,"pj-cs":f.value.pjCs,"onUpdate:show":s[0]||(s[0]=l=>i.value=l),onSubmit:g},null,8,["show","course","pj-cs"])])])}}},Je=z(ze,[["__scopeId","data-v-04236409"]]);export{Je as default};
